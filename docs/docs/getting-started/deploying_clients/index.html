<!DOCTYPE html>
<html>
  <head>
    <title>Velociraptor - Digging Deeper!</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Deploying Clients :: Velociraptor - Digging Deeper!</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/hybrid.css" rel="stylesheet">
<link href="/css/featherlight.min.css" rel="stylesheet">
<link href="/css/auto-complete.css" rel="stylesheet">
<link href="/theme-original/style.css" rel="stylesheet">

  <link href="/theme-original/variant-mine.css" rel="stylesheet">


<script src="/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link rel="stylesheet" href="/css/theme-mine.css">
<script src="/js/custom.js"></script>


    
  </head>
  <body data-url="/docs/getting-started/deploying_clients/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <a href="/">
  <img src="/images/logo.svg">
</a>
  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/js/lunr.min.js"></script>
		<script type="text/javascript" src="/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "\/";
        
		</script>
		<script type="text/javascript" src="/js/search.js"></script>
  </div>

      <ul class="topics">
    <li data-nav-id="/about/" class="dd-item haschildren
        ">
      <div>
      <a href="/about/">About Velociraptor</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/about/license/" class="dd-item">
        <div>
          <a href="/about/license/">
            License
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/docs/">Velociraptor Documentation</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/docs/getting-started/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/docs/getting-started/">Getting Started</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/getting-started/stand_alone/" class="dd-item">
        <div>
          <a href="/docs/getting-started/stand_alone/">
            Standalone Deployment
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/getting-started/deploying_clients/" class="dd-item active">
        <div>
          <a href="/docs/getting-started/deploying_clients/">
            Deploying Clients
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/getting-started/cloud/" class="dd-item">
        <div>
          <a href="/docs/getting-started/cloud/">
            Deploying in the cloud
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/getting-started/triaging/" class="dd-item">
        <div>
          <a href="/docs/getting-started/triaging/">
            Triaging
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/user-interface/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/user-interface/">User Interface</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/docs/user-interface/investigating_clients/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/user-interface/investigating_clients/">Investigating Clients</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/user-interface/investigating_clients/searching_clients/" class="dd-item">
        <div>
          <a href="/docs/user-interface/investigating_clients/searching_clients/">
            Searching for clients
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/investigating_clients/virtual_filesystem/" class="dd-item">
        <div>
          <a href="/docs/user-interface/investigating_clients/virtual_filesystem/">
            Client VFS
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/user-interface/artifacts/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/user-interface/artifacts/">Velociraptor Artifacts</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/user-interface/artifacts/client_artifacts/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/client_artifacts/">
            Client Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/client_events/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/client_events/">
            Client Event Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/server_artifacts/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/server_artifacts/">
            Server Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/server_events/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/server_events/">
            Server Event Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/add_artifacts/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/add_artifacts/">
            Customizing Artifacts
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/vql_reference/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/vql_reference/">VQL Reference</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/vql_reference/plugins/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/plugins/">
            VQL PLugins
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/event_plugins/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/event_plugins/">
            VQL Event PLugins
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/server/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/server/">
            VQL Server Plugins
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/functions/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/functions/">
            VQL Functions
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/templates/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/templates/">
            Report Templates
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/tips/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/tips/">
            Artifact Tips
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/filesystem_accessors/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/filesystem_accessors/">
            Filesystem Accessors
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/artifacts/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/artifacts/">Artifact Reference</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/artifacts/linux/" class="dd-item">
        <div>
          <a href="/docs/artifacts/linux/">
            Linux Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/windows_system/" class="dd-item">
        <div>
          <a href="/docs/artifacts/windows_system/">
            Windows System
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/server/" class="dd-item">
        <div>
          <a href="/docs/artifacts/server/">
            Server Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/triage/" class="dd-item">
        <div>
          <a href="/docs/artifacts/triage/">
            Windows Triage
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/detection/" class="dd-item">
        <div>
          <a href="/docs/artifacts/detection/">
            Windows Detection
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/events/" class="dd-item">
        <div>
          <a href="/docs/artifacts/events/">
            Windows Monitoring
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/misc/" class="dd-item">
        <div>
          <a href="/docs/artifacts/misc/">
            Miscelaneous
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/linux/linux/" class="dd-item">
        <div>
          <a href="/docs/artifacts/linux/linux/">
            Linux Artifacts
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/presentations/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/presentations/">Presentations and Workshops</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/presentations/rsa/" class="dd-item">
        <div>
          <a href="/docs/presentations/rsa/">
            RSA APJ 2019
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/presentations/crikeycon2019/" class="dd-item">
        <div>
          <a href="/docs/presentations/crikeycon2019/">
            Crikeycon 2019
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/presentations/nzitf2018/" class="dd-item">
        <div>
          <a href="/docs/presentations/nzitf2018/">
            NZITF 2018
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/blog/" class="dd-item haschildren
        ">
      <div>
      <a href="/blog/">Velociraptor Blog</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
        </ul>
    </li>




    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        










 <a href='/'>Velociraptor - Digging Deeper!</a> > <a href='/docs/'>Velociraptor Documentation</a> > <a href='/docs/getting-started/'>Getting Started</a> > Deploying Clients

 

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#running-clients-interactively">Running clients interactively</a></li>
<li><a href="#installing-an-msi">Installing an MSI</a>
<ul>
<li><a href="#official-release-msi">Official release MSI</a></li>
<li><a href="#installing-using-custom-msi-package">Installing using custom MSI package</a></li>
</ul></li>
<li><a href="#installing-the-client-as-a-service">Installing the client as a service</a></li>
<li><a href="#agentless-deployment">Agentless deployment</a>
<ul>
<li><a href="#creating-a-network-share">Creating a network share</a></li>
<li><a href="#creating-the-group-policy-object">Creating the group policy object</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Deploying Clients</h1>
  



    
    
    
    

<p>Velociraptor endpoint agents are called <code>clients</code>. Clients connect to
the server and wait for instructions (which mostly consist of VQL
statements), they then run any VQL queries and return the result to
the server.</p>

<p>There are a number of ways to run clients, depending on your
needs. Ultimately, however, the same Velociraptor binary is run with
the client configuration file generated in the previous steps
providing it with the key material and configuration.</p>

<p>This page summarizes the recommended ways to run the clients, and
discusses the pros and cons of each approach.</p>

<p>Note that all Velociraptor binaries are the same - there is no
distinction between client binaries or server binaries. Therefore you
can run the server or the client on each supported platform. It is
simply command line options telling the binary to behave as a server
or client.</p>

<h2 id="running-clients-interactively">Running clients interactively</h2>

<p>This method is most suitable for testing your deployment. In a command
shell simply run the client using the client configuration.</p>

<pre><code class="language-shell">$ velociraptor --config client.config.yaml client -v
</code></pre>

<p>The first time the client connects it will <code>enroll</code>. The enrollment
process requires the client to reveal basic information about itself.</p>

<h2 id="installing-an-msi">Installing an MSI</h2>

<p>An MSI is a standard windows installer
package. The advantages of using a standard packaging format is that
most enterprise system administration tools are used to deploying
software in MSI packages. Therefore you can use SCCM or group policy
to add the MSI to the assigned software group. See <a href="https://support.microsoft.com/en-us/help/816102/how-to-use-group-policy-to-remotely-install-software-in-windows-server">How to use Group Policy to remotely install software in Windows Server 2008 and in Windows Server 2003</a></p>

<h3 id="official-release-msi">Official release MSI</h3>

<p>The recommended way to install Velociraptor is via the release MSI on
the Github release page. Since the Velociraptor client requires a
configuration file to specifically tell it where to connect to, we can
not package the configuration file in the official release. Therefore
the official MSI does not include a configuration file.</p>

<p>The official release installs the Velociraptor service into
<code>C:\Program Files\Velociraptor\</code>. When the service starts, it attempts
to load the configuration file from <code>C:\Program
Files\Velociraptor\Velociraptor.config.yaml</code>.</p>

<p>If that file is not found, Velociraptor will wait and retry
periodically to locate the configuration file. When the file is found,
the client will be started.</p>

<p>Therefore when installing from the official MSI package you need to:</p>

<ol>
<li><p>Assign the MSI via Group Policy.</p></li>

<li><p>Copy the configuration file from a share to the Velociraptor
directory. This can be done via Group Policy Scheduled tasks or
another way (See the Group Policy procedure outlined below).</p></li>
</ol>

<p>As soon as the configuration file is copied, Velociraptor will begin
communicating with the server.</p>

<div class="notices note" >

One of the main benefits in using the official Velociraptor MSI is
that the MSI and the executable are signed. Windows defender
aggressively quarantines unsigned binaries, so it is highly
recommended that Velociraptor be signed.

</div>

<h3 id="installing-using-custom-msi-package">Installing using custom MSI package</h3>

<p>The official Velociraptor MSI package installs a service with a
predictable name. If you want to obfuscate Velociraptor a bit, you
might want to build your own MSI package with different binary names,
service name etc.</p>

<p>To create one of these follow the instructions
<a href="https://github.com/Velocidex/velociraptor/tree/master/docs/wix">here</a>.</p>

<p>If building your own MSI you might as well just include your own
configuration file in it. Then you simply assign your MSI to the group
policy and have it installed everywhere. You may want to also sign the
MSI.</p>

<h2 id="installing-the-client-as-a-service">Installing the client as a service</h2>

<p>It is possible to tell the executable to install itself as a
service. This option is not recommended because it does not use a
proper package manager, and therefore Velociraptor can not be easily
uninstalled.</p>

<p>Nevertheless this approach is possible to do via the Group Policy
scheduled tasks procedure outlined below. Simply run the following
command:</p>

<pre><code class="language-shell"># velociraptor.exe --config client.config.yaml service install
</code></pre>

<p>This will copy the binary to the location specified in the
configuration file under <code>Client.windows_installer</code>. You can change
the name of the binary and the service name.</p>

<h2 id="agentless-deployment">Agentless deployment</h2>

<p>There has been a lot of interest lately in &ldquo;Agentless hunting&rdquo;
especially using PowerShell. There are many reasons why Agentless
hunting is appealing - there are already a ton of endpoint agents and
yet another one may not be welcome. Sometimes we need to deploy
endpoint agents as part of a DFIR engagement and we may not want to
permanently install yet another agent on end points.</p>

<p>In the agentless deployment scenario we simply run the binary from a
network share using group policy settings. The downside to this
approach is that the endpoint needs to be on the domain network to
receive the group policy update (and have the network share
accessible) before it can run Velociraptor. When we run in Agentless
mode we are typically after collecting a bunch of artifacts via hunts
and then exiting - the agent will not restart after a reboot. So this
method is suitable for quick hunts on corporate (non roaming) assets.</p>

<p>See this <a href="/blog/html/2019/03/02/agentless_hunting_with_velociraptor.html">blog
post</a>
for the details of how to deploy Velociraptor in this mode.</p>

<h3 id="creating-a-network-share">Creating a network share</h3>

<p>The first step is to create a network share with the Velociraptor
binary and its configuration file. We will run the binary from the
share in this example, but for more reliability you may want to copy
the binary into e.g. a temp folder on the end point in case the system
becomes disconnected from the domain. For quick hunts though it should
be fine.</p>

<p>We create a directory on the server (I will create it on the domain
controller but you should probably not do that - find another machine
to host the share).</p>

<p><img src="../1.png" alt="Create Share" /></p>

<p>I created a directory <code>C:\Users\Deployment</code> and ensured that it is
read only. I have shared the directory as the name <code>Deployment</code>.</p>

<p>I now place the Velociraptor executable and client config file in that
directory and verify that I can run the binary from the network
share. The binary should be accessible via
<code>\\DC\Deployment\velociraptor.exe</code>:</p>

<p><img src="../2.png" alt="Testing Client Locally" /></p>

<h3 id="creating-the-group-policy-object">Creating the group policy object</h3>

<p>Next we create the group policy object which forces all domain
connected machines to run the Velociraptor client. We use the Group
Policy Management Console:</p>

<p><img src="../3.png" alt="Group Policy Object" /></p>

<p>Select the OU or the entire domain and click &ldquo;Create New GPO&rdquo;:</p>

<p><img src="../4.png" alt="New GPO" /></p>

<p>Now right click the GPO object and select &ldquo;Edit&rdquo;:</p>

<p><img src="../5.png" alt="Edit GPO" /></p>

<p>We will create a new scheduled task. Rather than schedule it at a
particular time, we will select to run it immediately. This will force
the command to run as soon as the endpoint updates its group policy
settings (i.e. we do not want to wait for the next reboot of the
endpoint).</p>

<p><img src="../6.png" alt="Scheduled Task" /></p>

<p>Next we give the task a name and a description. In order to allow
Velociraptor to access raw devices (e.g. to collect memory or NTFS
artifacts) we can specify that the client will run at
<code>NT_AUTHORITY\SYSTEM</code> privileges, and run without any user being
logged on. It is also worth ticking the &ldquo;hidden&rdquo; checkbox here to
prevent a console box from appearing.</p>

<p><img src="../7.png" alt="7" /></p>

<p>Next click the Actions tab and add a new action. This is where we
launch the Velociraptor client. The program will simply be launched
from the share (i.e. <code>\\DC\Deployment\velociraptor.exe</code>) and we give
it the arguments allowing it to read the provided configuration file
(i.e. <code>--config \\DC\Deployment\client.config.yaml client -v</code>).</p>

<p><img src="../8.png" alt="8" /></p>

<p>In the setting tab we can control how long we want the client to
run. For a quick hunt this may be an hour or two but maybe for a DFIR
engagement it might be a few days. The GPO will ensure the client is
killed after the allotted time.</p>

<p><img src="../9.png" alt="8" /></p>

<p>Once the GPO is installed it becomes active for all domain
machines. You can now schedule any hunts you wish using the
Velociraptor GUI. When a domain machine refreshes its group policy it
will run the client, which will enroll and immediately participate in
any outstanding hunts - thus collecting and delivering its artifacts
to the server. After the allotted time has passed, the client will
shut down without having installed anything on the endpoint.</p>

<p>You can force a group policy update by running the <code>gpupdate</code>
program. Now you can verify that Velociraptor is running:</p>

<p><img src="../10.png" alt="8" /></p>


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/docs/getting-started/stand_alone/" title="Standalone Deployment"> <i class="fa fa-chevron-left"></i><label>Standalone Deployment</label></a>
    <a class="nav nav-next" href="/docs/getting-started/cloud/" title="Deploying in the cloud" style="margin-right: 0px;"><label>Deploying in the cloud</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/js/clipboard.min.js"></script>
<script src="/js/featherlight.min.js"></script>
<script src="/js/html5shiv-printshiv.min.js"></script>

<script src="/js/modernizr.custom.71422.js"></script>
<script src="/js/docdock.js"></script>
<script src="/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>