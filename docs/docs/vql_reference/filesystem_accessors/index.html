<!DOCTYPE html>
<html>
  <head>
    <title>Velociraptor / Dig deeper</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Filesystem Accessors :: Velociraptor / Dig deeper</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/hybrid.css" rel="stylesheet">
<link href="/css/featherlight.min.css" rel="stylesheet">
<link href="/css/auto-complete.css" rel="stylesheet">
<link href="/theme-original/style.css" rel="stylesheet">

  <link href="/theme-original/variant-mine.css" rel="stylesheet">


<script src="/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link rel="stylesheet" href="/css/theme-mine.css">
<script src="/js/custom.js"></script>


    
  </head>
  <body data-url="/docs/vql_reference/filesystem_accessors/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <a href="/">
  <img src="/images/logo.svg">
</a>
  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/js/lunr.min.js"></script>
		<script type="text/javascript" src="/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "\/";
        
		</script>
		<script type="text/javascript" src="/js/search.js"></script>
  </div>

      <ul class="topics">
    <li data-nav-id="/about/" class="dd-item haschildren
        ">
      <div>
      <a href="/about/">About Velociraptor</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/about/features/" class="dd-item">
        <div>
          <a href="/about/features/">
            Velociraptor Features
          </a>
        </div>
    </li>
      <li data-nav-id="/about/license/" class="dd-item">
        <div>
          <a href="/about/license/">
            License
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/docs/">Velociraptor Documentation</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/docs/getting-started/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/getting-started/">Getting Started</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/getting-started/stand_alone/" class="dd-item">
        <div>
          <a href="/docs/getting-started/stand_alone/">
            Standalone Deployment
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/getting-started/deploying_clients/" class="dd-item">
        <div>
          <a href="/docs/getting-started/deploying_clients/">
            Deploying Clients
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/getting-started/cloud/" class="dd-item">
        <div>
          <a href="/docs/getting-started/cloud/">
            Deploying in the cloud
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/getting-started/triaging/" class="dd-item">
        <div>
          <a href="/docs/getting-started/triaging/">
            Triaging
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/user-interface/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/user-interface/">User Interface</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/docs/user-interface/investigating_clients/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/user-interface/investigating_clients/">Investigating Clients</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/user-interface/investigating_clients/searching_clients/" class="dd-item">
        <div>
          <a href="/docs/user-interface/investigating_clients/searching_clients/">
            Searching for clients
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/investigating_clients/virtual_filesystem/" class="dd-item">
        <div>
          <a href="/docs/user-interface/investigating_clients/virtual_filesystem/">
            Client VFS
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/user-interface/artifacts/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/user-interface/artifacts/">Velociraptor Artifacts</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/user-interface/artifacts/client_artifacts/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/client_artifacts/">
            Client Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/client_events/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/client_events/">
            Client Event Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/server_artifacts/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/server_artifacts/">
            Server Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/server_events/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/server_events/">
            Server Event Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/user-interface/artifacts/add_artifacts/" class="dd-item">
        <div>
          <a href="/docs/user-interface/artifacts/add_artifacts/">
            Customizing Artifacts
          </a>
        </div>
    </li>
        </ul>
    </li>
      <li data-nav-id="/docs/user-interface/api/" class="dd-item">
        <div>
          <a href="/docs/user-interface/api/">
            The Velociraptor API
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/vql_reference/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/docs/vql_reference/">VQL Reference</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/vql_reference/plugins/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/plugins/">
            VQL PLugins
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/event_plugins/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/event_plugins/">
            VQL Event PLugins
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/server/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/server/">
            VQL Server Plugins
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/functions/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/functions/">
            VQL Functions
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/templates/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/templates/">
            Report Templates
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/tips/" class="dd-item">
        <div>
          <a href="/docs/vql_reference/tips/">
            Artifact Tips
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/vql_reference/filesystem_accessors/" class="dd-item active">
        <div>
          <a href="/docs/vql_reference/filesystem_accessors/">
            Filesystem Accessors
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/artifacts/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/artifacts/">Artifact Reference</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/artifacts/linux/" class="dd-item">
        <div>
          <a href="/docs/artifacts/linux/">
            Linux Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/windows_system/" class="dd-item">
        <div>
          <a href="/docs/artifacts/windows_system/">
            Windows System
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/server/" class="dd-item">
        <div>
          <a href="/docs/artifacts/server/">
            Server Artifacts
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/triage/" class="dd-item">
        <div>
          <a href="/docs/artifacts/triage/">
            Windows Triage
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/detection/" class="dd-item">
        <div>
          <a href="/docs/artifacts/detection/">
            Windows Detection
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/events/" class="dd-item">
        <div>
          <a href="/docs/artifacts/events/">
            Windows Monitoring
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/misc/" class="dd-item">
        <div>
          <a href="/docs/artifacts/misc/">
            Miscelaneous
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/artifacts/linux/linux/" class="dd-item">
        <div>
          <a href="/docs/artifacts/linux/linux/">
            Linux Artifacts
          </a>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/docs/presentations/" class="dd-item haschildren
        ">
      <div>
      <a href="/docs/presentations/">Presentations and Workshops</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/docs/presentations/sans_dfir_summit2019/" class="dd-item">
        <div>
          <a href="/docs/presentations/sans_dfir_summit2019/">
            SANS 2019
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/presentations/rsa/" class="dd-item">
        <div>
          <a href="/docs/presentations/rsa/">
            RSA APJ 2019
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/presentations/crikeycon2019/" class="dd-item">
        <div>
          <a href="/docs/presentations/crikeycon2019/">
            Crikeycon 2019
          </a>
        </div>
    </li>
      <li data-nav-id="/docs/presentations/nzitf2018/" class="dd-item">
        <div>
          <a href="/docs/presentations/nzitf2018/">
            NZITF 2018
          </a>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/blog/" class="dd-item haschildren
        ">
      <div>
      <a href="/blog/">Velociraptor Blog</a><i class="fa fa-angle-right fa-lg category-icon"></i>
      </div>
        <ul>
        </ul>
    </li>




    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        










 <a href='/'>Velociraptor / Dig deeper</a> > <a href='/docs/'>Velociraptor Documentation</a> > <a href='/docs/vql_reference/'>VQL Reference</a> > Filesystem Accessors

 

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#filesystem-accessors">Filesystem Accessors</a></li>
<li><a href="#simple-filesystem-accessors">Simple filesystem accessors</a>
<ul>
<li><a href="#the-file-accessor">The file accessor</a></li>
<li><a href="#the-ntfs-accessor">The ntfs accessor</a></li>
<li><a href="#the-registry-accessor">The registry accessor</a></li>
</ul></li>
<li><a href="#other-filesystem-accessors">Other filesystem accessors</a>
<ul>
<li><a href="#the-data-accessor">The data accessor</a></li>
<li><a href="#the-zip-accessor">The zip accessor</a></li>
<li><a href="#the-raw-reg-accessor">The raw_reg accessor</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Filesystem Accessors</h1>
  



    
    
    
    

<h2 id="filesystem-accessors">Filesystem Accessors</h2>

<p>Many VQL plugins operate on files. However how we read files on the
endpoint can vary - depending on what we actually mean by a file. For
example, Velociraptor is able to read files parsed from the NTFS
parser, compressed files within Zip archives, or even files downloaded
from a URL. VQL specifies the way a file is read via an <code>accessor</code>
(essentially a file access driver), and a <code>path</code> which encodes how the
accessor will actually access the file.</p>

<h2 id="simple-filesystem-accessors">Simple filesystem accessors</h2>

<h3 id="the-file-accessor">The file accessor</h3>

<p>The <code>file</code> accessor uses the normal OS filesystem APIs to access files
and directories.</p>

<p>The limitations with this method is that some files are locked if they
are in use and we are not able to read them. For example, the registry
hives or the page file.</p>

<p>The path parameter is passed directly to the filesystem
APIs. Velociraptor supports both forward and reverse slashes on all
supported operating systems.</p>

<div class="notices note" ><p>On windows, Velociraptor emulates the top level directory as a list
   of available drives. For example, listing the &ldquo;/&rdquo; directory will
   yield directories such as &ldquo;C:&ldquo;, &ldquo;D:&rdquo; etc. Therefore Velociraptor
   paths always have a / at the top level, typically followed by a
   drive letter then the rest of the path.</p>
</div>


<h3 id="the-ntfs-accessor">The ntfs accessor</h3>

<p>The <code>ntfs</code> accessor uses Velociraptor&rsquo;s built in NTFS parser to
extract directory information and file contents.</p>

<p>This bypasses the normal file locking mechanism and allows us to
download and read locked files like registry hives.</p>

<p>The path is interpreted as a raw device, followed by an NTFS path. For
example the path <code>\\.\c:\Windows\System32</code> refers to the System32
directory as parsed by the ntfs parser from the raw device
<code>\\.\c:</code>. Supported raw devices include volume shadow copies (VSC) as
well.</p>

<p>As a convenience, the ntfs accessor recognizes a drive letter and
automatically maps it to the raw device. I.e. the following patths are
equivalent <code>\\.\c:\Windows</code> and <code>C:\Windows</code>.</p>

<p>Listing the top level directory will display all physical drives and
Volume Shadow Copies available on the machine.</p>

<div class="notices note" ><p>The backslash character is considered the path separator only for
paths following the device name. Supported device names include the
backslash as part of thier name. For example, listing the top level
directory will show <code>\\.\c:</code> as a single device, even though it
contains backslashs.</p>
</div>


<h3 id="the-registry-accessor">The registry accessor</h3>

<p>The <code>registry</code> accessor uses the OS APIs to view the registry as a
filesystem. You can use this to navigate the endpoint&rsquo;s registry hives
interactively.</p>

<p>Since registry values are typically small, Velociraptor also gets the
values in the directory listing as well, so it is not usually
necessary to download files from the registry hive.</p>

<div class="notices note" ><p>The Windows registry differs from a regular filesystem in that Key names may have forward slash, and value names may contain both forward and backward slashes. Therefore it is difficult to properly split a path into the correct key and value. Velociraptor treats a path as a list of components. Velociraptor will surround component names with quotes if they contain slashes to allow the path to be broken back into components. For example, <code>HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Word\Security\Trusted Documents\TrustRecords\&quot;%USERPROFILE%/Desktop/test.docx&quot;</code> represents the value named <code>%USERPROFILE%/Desktop/test.docx</code>.</p>
</div>


<h2 id="other-filesystem-accessors">Other filesystem accessors</h2>

<h3 id="the-data-accessor">The data accessor</h3>

<p>Sometimes it is necessary to pass a string to a plugin which expects a
filename (for example <code>yara()</code> plugin. In this case it is possible to
specify the <code>data</code> accessor which creates an in memory file from the
filename path passed to it.</p>

<h3 id="the-zip-accessor">The zip accessor</h3>

<p>Zip files contain compressed members. It is sometimes useful to be
able to treat members of the zip archive as simple files, then we can
scan or list them using other plugins.</p>

<p>The <code>zip</code> accessor makes that possible. However the accessor requires
an underlying file to actually unzip. Therefore the <code>zip</code> accessor
requires a url:</p>

<ul>
<li><p>The scheme part is used to specify the underlying accessor to access
the zip file.</p></li>

<li><p>The path part is used to specify the path to pass to the underlying
accessor.</p></li>

<li><p>The fragment part is used to specify the path within the zip file to
access.</p></li>
</ul>

<div class="notices tip" ><p>Do not attempt to construct the url by manually concatenating parts
because this does not properly handle escaping. Instead use the
<code>url()</code> function. For example <code>url(scheme='ntfs',
path=&quot;C:/Users/Test/my.zip&quot;, fragment=&quot;1.txt&quot;).String</code> will produce
the required url: <code>ntfs://C:/Users/Test/my.zip#1.txt</code> to access the
file 1.txt within the my.zip file as extracted by the ntfs raw parser.</p>
</div>


<h3 id="the-raw-reg-accessor">The raw_reg accessor</h3>

<p>Parsing of raw registry hives is provided by the <code>raw_reg</code>
accessor. Similarly to the zip accessor above, the <code>raw_reg</code> accessor
requires an undelying file to read. Therefore it also requires a path
formatted as a url:</p>

<ul>
<li><p>The scheme part is used to specify the underlying accessor to access
the raw registry hive file.</p></li>

<li><p>The path part is used to specify the path to pass to the underlying
accessor.</p></li>

<li><p>The fragment part is used to specify the key or value within the
registry hive to access.</p></li>
</ul>

<p>Note that this accessor usually requires an underlying file that is
accessed by the raw NTFS parser (since registry hives are locked at
runtime).</p>


    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/docs/vql_reference/tips/" title="Artifact Tips"> <i class="fa fa-chevron-left"></i><label>Artifact Tips</label></a>
    <a class="nav nav-next" href="/docs/artifacts/" title="Artifact Reference" style="margin-right: 0px;"><label>Artifact Reference</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/js/clipboard.min.js"></script>
<script src="/js/featherlight.min.js"></script>
<script src="/js/html5shiv-printshiv.min.js"></script>

<script src="/js/modernizr.custom.71422.js"></script>
<script src="/js/docdock.js"></script>
<script src="/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>